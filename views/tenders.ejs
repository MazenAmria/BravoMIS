<div class="all-wrapper">
    <div class="row" style="margin-bottom: 20px;">
        <ul class="widget h-nav">
            <% for (const tab of tabs) { %>
                <li class="h-nav-item"
                    onclick="
                            showTenders('/<%= tab.path %>', '<%= tab.method %>');
                            [...$('.h-nav-item')].forEach(item => item.classList.remove('active'));
                            event.currentTarget.classList.add('active');
                            "><%= tab.title %></li>
            <% } %>
        </ul>
    </div>
    <div class="row">
        <tenders-template></tenders-template>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(() => {
        $('.h-nav-item')[0].click();
    });
    function popUp(path) {
        event.preventDefault();
        $.ajax({
            url: '/api/tenders/open/t.mazenamria',
            method: 'GET',
            success: (data) => {
                let ejsData = ejs.render(popUpTemplate, {
                    title: 'المناقصات',
                    tableCount: 1,
                    columns: data.columns,
                    tuples: data.tuples
                });
                $('pop-up-template').html(ejsData);
                styleTables({}, 1);
            },
            error: (xhr, ajaxOptions, thrownError) => {
                let ejsData = ejs.render(errTemplate, {errCode: xhr.status, errMessage: thrownError});
                $('pop-up-template').html(ejsData);
            }
        });
    }
    function renderLinks() {
        [...$('td')].filter(item => item.getAttribute('field') === 'offers').forEach((item) => {
            let path = `/${item.innerHTML}`;
            let text = 'أنقر هنا لرؤية كافة العروض';
            item.innerHTML = `
                <a class="d-link" onclick="popUp('${path}');" style="cursor: pointer;">
                    <i class="fas fa-clipboard-list"></i> ${text}
                </a>
            `;
        });
    }
    function showTenders(path, method) {
        event.preventDefault();
        $.ajax({
            url: path,
            method: method,
            data: {},
            success: (data) => {
                let ejsData = ejs.render(tableTemplate, {
                    title: 'المناقصات',
                    tableCount: 0,
                    columns: data.columns,
                    tuples: data.tuples
                });
                $('tenders-template').html(ejsData);
                styleTables({}, 0);
                renderLinks();
            },
            error: (xhr, ajaxOptions, thrownError) => {
                let ejsData = ejs.render(errTemplate, {errCode: xhr.status, errMessage: thrownError});
                $('tenders-template').html(ejsData);
            }
        });
    }
</script>
